浏览器预在自定义字体加载之前先用**备用字体渲染**，再换成自定义字体，字体间尺寸不一样，会导致累计布局偏移，字体叫做 **FOIT（Flash of Invisible Text）** 或 **FOUT（Flash of Unstyled Text）**，它是造成 **累计布局偏移（CLS）** 的常见原因之一。

---

### 🔍 为什么会“先用备用字体渲染，再换成自定义字体”？

#### 根本原因：**自定义字体文件需要时间从网络加载**。

浏览器渲染网页时，遵循以下大致流程：

1. **解析 HTML 和 CSS**
2. **发现 `@font-face` 声明的自定义字体**
3. **开始下载字体文件（如 `.woff2`）**
4. **在字体下载完成前，必须决定：是等？还是先用别的字体显示？**

> 🕒 **字体文件还没下载完，但用户不能一直看着空白页面！**

所以，浏览器会根据 `@font-face` 中的 `font-display` 属性策略，**临时使用系统默认字体（如 Arial、San Francisco、PingFang 等）先显示文本**，等自定义字体加载完成后，再替换上去。导致累计布局偏移

---

### 🧩 举个例子

```css
@font-face {
  font-family: 'CustomFont';
  src: url('/fonts/custom.woff2') format('woff2');
  font-display: swap; /* 关键！ */
}
body {
  font-family: 'CustomFont', sans-serif;
}
```

- 浏览器看到 `font-family: 'CustomFont', sans-serif`
- 发现 `'CustomFont'` 还没加载
- 因为 `font-display: swap`，**立即用 `sans-serif`（系统字体）渲染文本**
- 几百毫秒后，`custom.woff2` 下载完成
- 浏览器把文本**从系统字体切换成 CustomFont**

✅ 用户不会看到空白（避免了 FOIT）  
⚠️ 但如果两种字体的**字宽、行高、字号不同**，文本区域大小会变 → **推挤周围元素 → 触发 CLS！**

---

### ❓为什么自定义字体和系统字体尺寸不一样？

不同字体的 **设计指标（metrics）** 不同，例如：

| 属性                  | 自定义字体（如 Inter） | 系统字体（如 Arial） |
| ------------------- | -------------- | ------------- |
| 字符宽度（x-height）      | 可能更宽或更窄        | 固定            |
| 行高（line-height）     | 可能更高           | 较紧凑           |
| 字间距（letter-spacing） | 可能有默认间距        | 通常无           |

👉 即使你写了 `font-size: 16px`，**实际占据的空间也可能不同**！

例如：

- 系统字体下，一行文字占 **20px 高**
- 自定义字体加载后，变成 **24px 高** → 下方所有内容被往下推 4px → **这就是一次布局偏移！**

---

### ✅ 如何避免因字体导致的 CLS？

#### 方法 1：使用 `font-display: optional`（最激进但最稳）

```css
@font-face {
  font-family: 'CustomFont';
  src: url(...);
  font-display: optional; /* 如果字体没在极短时间内加载，就永远不用它 */
}
```

- 浏览器只在**首屏渲染前极短时间**内尝试加载字体。
- 超时就**直接用系统字体，永不替换**。
- **零 CLS 风险**，但可能牺牲品牌字体一致性。

#### 方法 2：选择与系统字体“度量兼容”的自定义字体

- 使用像 **Inter、Roboto、Open Sans** 等设计时就考虑了与系统字体对齐的字体。
- 它们在相同 `font-size` 下，**高度和宽度接近系统字体**，减少跳动。

#### 方法 3：手动匹配行高和尺寸

```css
body {
  font-family: 'CustomFont', -apple-system, BlinkMacSystemFont, sans-serif;
  line-height: 1.5; /* 显式设置，避免字体自带行高差异 */
}
```

#### 方法 4：预加载关键字体（减少等待时间）

```html
<link rel="preload" as="font" href="/fonts/custom.woff2" type="font/woff2" crossorigin>
```

- 让字体尽早开始下载，**缩短 FOUT 时间窗口**，降低用户感知到变化的概率。

#### 方法 5：用 CSS `size-adjust` 微调（实验性）

```css
@font-face {
  font-family: 'AdjustedCustomFont';
  src: url(...);
  size-adjust: 95%; /* 缩小一点，匹配系统字体视觉大小 */
}
```

> ⚠️ 浏览器支持有限（Chrome 98+），需谨慎使用。

---

### 📌 总结：为什么会出现“先用系统字体”？

> **因为网络加载需要时间，而用户体验不能等。**  
> 浏览器为了不让用户看到空白文本（FOIT），选择**先用本地已有的系统字体显示内容**，等自定义字体加载完成后再替换——这个过程如果导致元素尺寸变化，就会引发 **CLS（累计布局偏移）**。

---

### ✅ 最佳实践建议

- 对于**正文、标题等关键文本**，优先保证布局稳定。
- 使用 `font-display: swap` + **度量兼容字体** + **预加载** 是平衡体验与性能的常用组合。
- 如果 CLS 是核心指标（如电商、新闻站），可考虑 `font-display: optional`。

这样既能保持较快的首屏渲染，又能有效控制 CLS 在 0.1 以内 ✅。